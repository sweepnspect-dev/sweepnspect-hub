<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SweepNspect Hub — Launch Playbook</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap');

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #0a0e1a;
  --bg-card: #111827;
  --bg-card-hover: #1a2236;
  --bg-surface: #0f1629;
  --accent: #ea580c;
  --accent-glow: rgba(234, 88, 12, 0.25);
  --accent-dim: rgba(234, 88, 12, 0.08);
  --green: #22c55e;
  --green-dim: rgba(34, 197, 94, 0.12);
  --yellow: #eab308;
  --yellow-dim: rgba(234, 179, 8, 0.12);
  --red: #ef4444;
  --red-dim: rgba(239, 68, 68, 0.12);
  --text: #e2e8f0;
  --text-muted: #64748b;
  --text-dim: #475569;
  --border: rgba(255,255,255,0.06);
  --border-accent: rgba(234, 88, 12, 0.2);
  --mono: 'JetBrains Mono', monospace;
  --sans: 'DM Sans', sans-serif;
}

html { scroll-behavior: smooth; }

body {
  font-family: var(--sans);
  background: var(--bg);
  color: var(--text);
  line-height: 1.5;
  min-height: 100vh;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse at 20% 0%, rgba(234, 88, 12, 0.04) 0%, transparent 60%),
    radial-gradient(ellipse at 80% 100%, rgba(34, 197, 94, 0.02) 0%, transparent 60%);
  pointer-events: none;
  z-index: 0;
}

/* ─── TOP BAR ─── */
.topbar {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(10, 14, 26, 0.92);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  padding: 0 24px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.topbar-left {
  display: flex;
  align-items: center;
  gap: 20px;
}

.logo {
  font-family: var(--mono);
  font-weight: 800;
  font-size: 15px;
  letter-spacing: -0.5px;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo-mark {
  width: 28px;
  height: 28px;
  background: var(--accent);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 800;
  color: #fff;
  box-shadow: 0 0 20px var(--accent-glow);
}

.topbar-center {
  display: flex;
  align-items: center;
  gap: 32px;
}

.readiness-ring {
  position: relative;
  width: 42px;
  height: 42px;
}

.readiness-ring svg {
  transform: rotate(-90deg);
  width: 42px;
  height: 42px;
}

.readiness-ring .bg-ring {
  fill: none;
  stroke: rgba(255,255,255,0.06);
  stroke-width: 3;
}

.readiness-ring .fg-ring {
  fill: none;
  stroke: var(--accent);
  stroke-width: 3;
  stroke-linecap: round;
  transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  filter: drop-shadow(0 0 6px var(--accent-glow));
}

.readiness-pct {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 700;
  color: var(--accent);
}

.readiness-label {
  font-size: 11px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: 600;
}

.level-display {
  display: flex;
  align-items: center;
  gap: 12px;
}

.level-badge {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 700;
  color: var(--accent);
  background: var(--accent-dim);
  border: 1px solid var(--border-accent);
  padding: 4px 10px;
  border-radius: 4px;
  letter-spacing: 0.5px;
}

.level-name {
  font-size: 13px;
  font-weight: 600;
  color: var(--text);
}

.xp-bar-container {
  display: flex;
  align-items: center;
  gap: 8px;
}

.xp-bar {
  width: 120px;
  height: 6px;
  background: rgba(255,255,255,0.06);
  border-radius: 3px;
  overflow: hidden;
}

.xp-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), #f97316);
  border-radius: 3px;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 0 8px var(--accent-glow);
}

.xp-text {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-muted);
  white-space: nowrap;
}

.topbar-right {
  display: flex;
  align-items: center;
  gap: 16px;
}

.today-date {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--accent);
  background: var(--accent-dim);
  border: 1px solid var(--border-accent);
  padding: 4px 10px;
  border-radius: 4px;
  letter-spacing: 0.5px;
  font-weight: 600;
}

/* ─── NOTIFICATIONS ─── */
.notif-btn {
  position: relative;
  background: none;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 8px;
  cursor: pointer;
  color: var(--text-muted);
  transition: all 0.2s;
}

.notif-btn:hover { color: var(--text); border-color: rgba(255,255,255,0.12); }
.notif-btn svg { width: 18px; height: 18px; display: block; }

.notif-badge {
  position: absolute;
  top: -4px;
  right: -4px;
  width: 16px;
  height: 16px;
  background: var(--red);
  border-radius: 50%;
  font-size: 9px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  border: 2px solid var(--bg);
}

.notif-dropdown {
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  width: 320px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 10px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  display: none;
  overflow: hidden;
  z-index: 200;
}

.notif-dropdown.open { display: block; }

.notif-header {
  padding: 12px 16px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-muted);
  border-bottom: 1px solid var(--border);
}

.notif-item {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  gap: 10px;
  align-items: flex-start;
  transition: background 0.15s;
}

.notif-item:hover { background: rgba(255,255,255,0.02); }
.notif-item:last-child { border-bottom: none; }

.notif-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--accent);
  margin-top: 6px;
  flex-shrink: 0;
}

.notif-content { flex: 1; }

.notif-text {
  font-size: 13px;
  color: var(--text);
  line-height: 1.4;
}

.notif-time {
  font-size: 11px;
  color: var(--text-dim);
  margin-top: 2px;
  font-family: var(--mono);
}

/* ─── MAIN LAYOUT ─── */
.main {
  display: grid;
  grid-template-columns: 1fr 300px;
  gap: 0;
  min-height: calc(100vh - 64px);
  position: relative;
  z-index: 1;
}

.content { padding: 24px; }

.sidebar {
  border-left: 1px solid var(--border);
  background: var(--bg-surface);
  padding: 24px;
  position: sticky;
  top: 64px;
  height: calc(100vh - 64px);
  overflow-y: auto;
}

/* ─── STATS ROW ─── */
.stats-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  margin-bottom: 24px;
}

.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 16px;
  transition: border-color 0.2s;
}

.stat-card:hover { border-color: rgba(255,255,255,0.1); }

.stat-label {
  font-size: 11px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  font-weight: 600;
  margin-bottom: 6px;
}

.stat-value {
  font-family: var(--mono);
  font-size: 24px;
  font-weight: 800;
  color: var(--text);
  line-height: 1;
}

.stat-value.accent { color: var(--accent); }
.stat-value.green { color: var(--green); }

.stat-sub {
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 4px;
  font-family: var(--mono);
}

/* ─── SECTION LABELS ─── */
.section-label {
  font-size: 11px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  font-weight: 700;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.section-label::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border);
}

/* ─── FOUNDATION SECTION ─── */
.foundation-section {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 10px;
  margin-bottom: 24px;
  overflow: hidden;
}

.foundation-header {
  padding: 14px 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  transition: background 0.2s;
}

.foundation-header:hover { background: rgba(255,255,255,0.02); }

.foundation-icon {
  width: 32px;
  height: 32px;
  border-radius: 6px;
  background: var(--green-dim);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  flex-shrink: 0;
}

.foundation-title {
  flex: 1;
  font-size: 13px;
  font-weight: 700;
  color: var(--green);
}

.foundation-stats {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-muted);
}

.foundation-chevron {
  font-size: 14px;
  color: var(--text-dim);
  transition: transform 0.3s;
}

.foundation-section.expanded .foundation-chevron { transform: rotate(180deg); }

.foundation-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.foundation-section.expanded .foundation-body { max-height: 800px; }

.foundation-body-inner {
  padding: 0 16px 16px;
}

.foundation-group {
  margin-bottom: 12px;
}

.foundation-group:last-child { margin-bottom: 0; }

.foundation-group-name {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-dim);
  margin-bottom: 6px;
}

.foundation-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 0;
  font-size: 12px;
  color: var(--text-dim);
}

.foundation-check {
  width: 14px;
  height: 14px;
  background: var(--green);
  border-radius: 3px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.foundation-check::after {
  content: '';
  width: 5px;
  height: 8px;
  border: solid #fff;
  border-width: 0 1.5px 1.5px 0;
  transform: rotate(45deg) translate(-0.5px, -0.5px);
}

/* ─── PHASE CARDS ─── */
.phases-container {
  display: flex;
  flex-direction: column;
  gap: 0;
  position: relative;
  padding-left: 32px;
}

/* Timeline connector */
.phases-container::before {
  content: '';
  position: absolute;
  left: 11px;
  top: 12px;
  bottom: 12px;
  width: 2px;
  background: linear-gradient(
    to bottom,
    #f59e0b 0%, #f59e0b 5%,
    #ea580c 10%, #ea580c 20%,
    #3b82f6 25%, #3b82f6 35%,
    #8b5cf6 40%, #8b5cf6 50%,
    #22c55e 55%, #22c55e 65%,
    #06b6d4 70%, #06b6d4 80%,
    #a78bfa 85%, #a78bfa 100%
  );
  opacity: 0.3;
  border-radius: 1px;
}

.phase-card {
  position: relative;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 10px;
  overflow: hidden;
  transition: all 0.25s;
  margin-bottom: 12px;
}

.phase-card:last-child { margin-bottom: 0; }

.phase-card:hover {
  border-color: rgba(255,255,255,0.1);
  box-shadow: 0 8px 30px rgba(0,0,0,0.3);
}

.phase-card.expanded {
  box-shadow: 0 12px 40px rgba(0,0,0,0.4);
}

.phase-card.current {
  border-color: rgba(255,255,255,0.12);
}

/* Timeline dot */
.phase-dot {
  position: absolute;
  left: -27px;
  top: 22px;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: 2px solid var(--bg);
  z-index: 2;
}

.phase-dot.current {
  box-shadow: 0 0 8px currentColor;
  animation: pulseDot 2s infinite;
}

@keyframes pulseDot {
  0%, 100% { box-shadow: 0 0 6px currentColor; }
  50% { box-shadow: 0 0 14px currentColor; }
}

.phase-color-bar {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  border-radius: 10px 0 0 10px;
}

.phase-header {
  padding: 16px 16px 16px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
}

.phase-number {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 800;
  width: 28px;
  height: 28px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  letter-spacing: -0.5px;
}

.phase-info { flex: 1; min-width: 0; }

.phase-name-row {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.phase-name {
  font-size: 14px;
  font-weight: 700;
  color: var(--text);
}

.phase-badge-live {
  font-family: var(--mono);
  font-size: 9px;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 2px 8px;
  border-radius: 3px;
  animation: livePulse 2s infinite;
}

@keyframes livePulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

.phase-badge-parallel {
  font-family: var(--mono);
  font-size: 9px;
  font-weight: 600;
  color: var(--text-dim);
  background: rgba(255,255,255,0.04);
  padding: 2px 6px;
  border-radius: 3px;
  letter-spacing: 0.3px;
}

.phase-meta {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 3px;
}

.phase-timeframe {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-dim);
}

.phase-desc {
  font-size: 11px;
  color: var(--text-muted);
  font-style: italic;
}

.phase-progress {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}

.phase-pct {
  font-family: var(--mono);
  font-size: 20px;
  font-weight: 800;
  line-height: 1;
}

.phase-pct.high { color: var(--green); }
.phase-pct.mid { color: var(--yellow); }
.phase-pct.low { color: var(--text-dim); }
.phase-pct.zero { color: var(--text-dim); opacity: 0.5; }

.phase-bar {
  height: 3px;
  background: rgba(255,255,255,0.04);
  margin: 0 20px 0 20px;
}

.phase-bar-fill {
  height: 100%;
  border-radius: 2px;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.phase-items {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.phase-card.expanded .phase-items { max-height: 800px; }

.phase-items-inner { padding: 8px 20px 16px; }

/* ─── CHECK ITEMS (shared) ─── */
.check-item {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 8px 0;
  border-bottom: 1px solid var(--border);
  transition: all 0.2s;
}

.check-item:last-child { border-bottom: none; }

.check-box {
  width: 18px;
  height: 18px;
  border: 2px solid var(--text-dim);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  margin-top: 1px;
}

.check-box:hover { border-color: var(--accent); }

.check-box.checked {
  background: var(--green);
  border-color: var(--green);
}

.check-box.checked::after {
  content: '';
  width: 6px;
  height: 10px;
  border: solid #fff;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg) translate(-1px, -1px);
}

.check-content { flex: 1; min-width: 0; }

.check-label {
  font-size: 13px;
  color: var(--text);
}

.check-note {
  font-size: 11px;
  color: var(--text-dim);
  margin-top: 2px;
}

.check-item.done .check-label {
  color: var(--text-dim);
  text-decoration: line-through;
}

.check-item.done .check-note { opacity: 0.5; }

.check-xp {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-dim);
  background: rgba(255,255,255,0.04);
  padding: 2px 6px;
  border-radius: 3px;
  flex-shrink: 0;
  margin-top: 2px;
}

/* ─── SIDEBAR ─── */
.sidebar-section {
  margin-bottom: 28px;
}

.sidebar-title {
  font-size: 11px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  font-weight: 700;
  margin-bottom: 14px;
}

.up-next-item {
  padding: 12px;
  background: rgba(255,255,255,0.02);
  border: 1px solid var(--border);
  border-radius: 8px;
  margin-bottom: 8px;
  transition: all 0.2s;
  cursor: pointer;
}

.up-next-item:hover {
  background: rgba(255,255,255,0.04);
  border-color: var(--border-accent);
}

.up-next-tag {
  font-size: 9px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  padding: 2px 6px;
  border-radius: 3px;
  display: inline-block;
  margin-bottom: 6px;
}

.up-next-name {
  font-size: 13px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 8px;
  line-height: 1.3;
}

.up-next-btn {
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 700;
  color: var(--accent);
  background: var(--accent-dim);
  border: 1px solid var(--border-accent);
  padding: 4px 12px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.up-next-btn:hover {
  background: var(--accent);
  color: #fff;
}

/* ─── MILESTONE ─── */
.milestone-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 0;
  border-bottom: 1px solid var(--border);
}

.milestone-item:last-child { border-bottom: none; }

.milestone-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.milestone-dot.done { background: var(--green); box-shadow: 0 0 6px rgba(34, 197, 94, 0.4); }
.milestone-dot.active { background: var(--accent); box-shadow: 0 0 6px var(--accent-glow); animation: pulse 2s infinite; }
.milestone-dot.pending { background: var(--text-dim); }

.milestone-text {
  font-size: 12px;
  color: var(--text);
  flex: 1;
}

.milestone-text.done { color: var(--text-dim); }

.milestone-date {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-dim);
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* ─── XP POPUP ─── */
.xp-popup {
  position: fixed;
  pointer-events: none;
  font-family: var(--mono);
  font-size: 16px;
  font-weight: 800;
  color: var(--accent);
  text-shadow: 0 0 20px var(--accent-glow);
  z-index: 9999;
  opacity: 0;
  transform: translateY(0);
  transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.xp-popup.show {
  opacity: 1;
  transform: translateY(-40px);
}

.xp-popup.fade {
  opacity: 0;
  transform: translateY(-60px);
}

/* ─── LEVEL UP FLASH ─── */
.level-up-overlay {
  position: fixed;
  inset: 0;
  background: rgba(234, 88, 12, 0.08);
  z-index: 9998;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s;
}

.level-up-overlay.show { opacity: 1; }

/* ─── SCROLLBAR ─── */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.12); }

/* ─── RESPONSIVE ─── */
@media (max-width: 900px) {
  .main { grid-template-columns: 1fr; }
  .sidebar {
    position: static;
    height: auto;
    border-left: none;
    border-top: 1px solid var(--border);
  }
  .stats-row { grid-template-columns: repeat(2, 1fr); }
  .topbar-center { display: none; }
}

@media (max-width: 600px) {
  .topbar {
    padding: 0 12px;
    height: 56px;
  }

  .logo { font-size: 13px; gap: 8px; }
  .logo-mark { width: 24px; height: 24px; font-size: 12px; }

  .content { padding: 12px; }
  .sidebar { padding: 16px; }

  .stats-row {
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-bottom: 16px;
  }

  .stat-card { padding: 12px; }
  .stat-value { font-size: 20px; }

  .phases-container { padding-left: 0; }
  .phases-container::before { display: none; }
  .phase-dot { display: none; }
  .phase-color-bar { width: 3px; }

  .phase-header { padding: 14px 12px 14px 14px; }
  .phase-number { width: 26px; height: 26px; font-size: 10px; }
  .phase-name { font-size: 13px; }
  .phase-pct { font-size: 18px; }
  .phase-bar { margin: 0 14px; }
  .phase-items-inner { padding: 6px 14px 14px; }

  .check-item { padding: 10px 0; gap: 8px; }
  .check-label { font-size: 13px; }
  .check-xp { font-size: 9px; padding: 2px 5px; }

  .up-next-item { padding: 10px; }

  .notif-dropdown {
    width: calc(100vw - 24px);
    right: -8px;
  }

  .section-label { font-size: 10px; margin-bottom: 12px; }

  .topbar-right { gap: 10px; }
  .today-date { display: none; }
  #clock { display: none; }

  .foundation-header { padding: 12px; }
}
</style>
</head>
<body>

<div class="level-up-overlay" id="levelUpOverlay"></div>

<!-- TOP BAR -->
<header class="topbar">
  <div class="topbar-left">
    <div class="logo">
      <div class="logo-mark">S</div>
      SweepNspect Hub
    </div>
  </div>

  <div class="topbar-center">
    <div style="display:flex;align-items:center;gap:10px;">
      <div class="readiness-ring" id="readinessRing">
        <svg viewBox="0 0 42 42">
          <circle class="bg-ring" cx="21" cy="21" r="18" />
          <circle class="fg-ring" id="readinessCircle" cx="21" cy="21" r="18"
            stroke-dasharray="113.1" stroke-dashoffset="113.1" />
        </svg>
        <div class="readiness-pct" id="readinessPct">0%</div>
      </div>
      <span class="readiness-label">Launch Ready</span>
    </div>

    <div class="level-display">
      <span class="level-badge" id="levelBadge">LVL 1</span>
      <span class="level-name" id="levelName">Getting Started</span>
      <div class="xp-bar-container">
        <div class="xp-bar">
          <div class="xp-bar-fill" id="xpBarFill" style="width:0%"></div>
        </div>
        <span class="xp-text" id="xpText">0 / 0 XP</span>
      </div>
    </div>
  </div>

  <div class="topbar-right">
    <div class="today-date" id="todayDate"></div>
    <div style="position:relative;" id="notifContainer">
      <button class="notif-btn" id="notifBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        <span class="notif-badge" id="notifBadge">3</span>
      </button>
      <div class="notif-dropdown" id="notifDropdown">
        <div class="notif-header">Notifications</div>
        <div class="notif-item">
          <div class="notif-dot" style="background:var(--green)"></div>
          <div class="notif-content">
            <div class="notif-text">Founding 25 page live &mdash; accepting applications</div>
            <div class="notif-time">today</div>
          </div>
        </div>
        <div class="notif-item">
          <div class="notif-dot" style="background:var(--accent)"></div>
          <div class="notif-content">
            <div class="notif-text">NCSG week &mdash; chimney pros are online and buzzing</div>
            <div class="notif-time">Feb 24&ndash;28</div>
          </div>
        </div>
        <div class="notif-item">
          <div class="notif-dot"></div>
          <div class="notif-content">
            <div class="notif-text">Launch playbook activated &mdash; remote founding drive</div>
            <div class="notif-time">just now</div>
          </div>
        </div>
      </div>
    </div>
    <div style="font-family:var(--mono);font-size:11px;color:var(--text-dim);" id="clock"></div>
  </div>
</header>

<!-- MAIN -->
<div class="main">
  <div class="content">
    <!-- STATS ROW -->
    <div class="stats-row" id="statsRow"></div>

    <!-- FOUNDATION -->
    <div id="foundationContainer"></div>

    <!-- PHASES -->
    <div class="section-label">Launch Playbook</div>
    <div class="phases-container" id="phasesContainer"></div>
  </div>

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">Up Next</div>
      <div id="upNext"></div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-title">Milestones</div>
      <div id="milestones"></div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-title">Session</div>
      <div style="font-family:var(--mono);font-size:11px;color:var(--text-dim);line-height:1.8;">
        <div>Items done: <span id="sessionDone" style="color:var(--green);">0</span></div>
        <div>XP earned: <span id="sessionXP" style="color:var(--accent);">0</span></div>
        <div>Streak: <span id="streak" style="color:var(--yellow);">0 days</span></div>
      </div>
    </div>
  </aside>
</div>

<script>
// ═══════════════════════════════════════════════════════════
// DATA
// ═══════════════════════════════════════════════════════════

const FOUNDATION = [
  { group: 'Legal', items: ['Privacy Policy', 'Terms of Service', 'Founding 25 Agreement', 'App Store Compliance'] },
  { group: 'Financial', items: ['Pricing Model Locked', 'Stripe Account', 'Bookkeeping Dashboard'] },
  { group: 'Marketing', items: ['Brand Positioning Doc', 'Website Live', 'Founding 25 Page'] },
  { group: 'Distribution', items: ['Developer Account', 'App Signing', 'Store Listing', 'Screenshots', 'Closed Testing', 'Privacy Policy URL'] },
  { group: 'Product', items: ['Inspection Workflow', 'PDF Reports', 'Invoicing', 'Booking', 'Expenses', 'DB Encrypted', 'Security Audit', 'Offline-First'] },
  { group: 'Support', items: ['Support Email Setup'] },
  { group: 'Founding 25', items: ['Charter Written', 'Website Page Live', 'Selection Criteria Defined'] },
  { group: 'Partnerships', items: ['Mark Stoner Outreach'] },
];

const FOUNDATION_COUNT = FOUNDATION.reduce((sum, g) => sum + g.items.length, 0); // 29
const FOUNDATION_XP = 730;

const PHASES = [
  {
    id: 'phase0', name: 'Launch Prep', timeframe: 'Today',
    description: 'Get your weapons ready', color: '#f59e0b', icon: '\u26A1',
    items: [
      { id: 'p0-founding-verify', name: 'Founding 25 page verified working on mobile', xp: 10, note: 'Test form submission end-to-end' },
      { id: 'p0-facebook-page', name: 'Create Facebook Page (basic placeholder)', xp: 10, note: 'Name + logo + link to sweepnspect.com' },
      { id: 'p0-share-link', name: 'Founding page share link + screenshot ready', xp: 10, note: 'sweepnspect.com/founding \u2014 easy to paste' },
      { id: 'p0-pitch-text', name: 'Write DM/message pitch template', xp: 15, note: 'Adapt 30-sec elevator pitch for text/DM' },
      { id: 'p0-target-list', name: 'List 20 target sweeps to reach out to', xp: 15, note: 'People you know, know of, or can find online' },
      { id: 'p0-demo-record', name: 'Record 2-minute screen recording demo', xp: 20, note: 'Walk through an inspection \u2014 the finalization ceremony sells it' },
      { id: 'p0-join-groups', name: 'Join 3\u20135 Facebook chimney community groups', xp: 10, note: 'Where sweeps actually hang out online' },
    ]
  },
  {
    id: 'phase1', name: 'Founding 25 Drive', timeframe: 'Feb 24 \u2014 Mar 7',
    description: 'Fill the application pool', color: '#ea580c', icon: '\uD83D\uDD25',
    items: [
      { id: 'p1-group-intros', name: 'Post introduction in each FB chimney group', xp: 15, note: 'Value first \u2014 "built by a sweep, here\'s what it does"' },
      { id: 'p1-dm-20', name: 'Direct message 20+ sweeps with personal pitch', xp: 25, note: 'Not copy-paste \u2014 personal, mention something specific' },
      { id: 'p1-ncsg-buzz', name: 'Post leveraging NCSG week buzz', xp: 15, note: '"While chimney pros gather this week..." \u2014 ride the wave remotely' },
      { id: 'p1-demo-video', name: 'Post demo video in FB groups', xp: 15, note: 'The 2-min screen recording \u2014 let the app speak' },
      { id: 'p1-fb-page-content', name: 'Post founding opportunity on Facebook Page', xp: 10, note: 'The curated pitch: "25 sweeps, hand-picked, lifetime free"' },
      { id: 'p1-daily-content', name: 'Post 5+ pieces of content across NCSG week', xp: 20, note: 'Screenshots, features, "built by a sweep" story, founding CTA' },
      { id: 'p1-30-apps', name: 'Get 30+ Founding 25 applications submitted', xp: 40, note: 'The pool you\'ll select from \u2014 more apps = better selection' },
      { id: 'p1-respond-all', name: 'Respond to every application within 24 hours', xp: 20, note: 'Personal acknowledgment \u2014 "Got your app, reviewing this week"' },
      { id: 'p1-ask-referrals', name: 'Ask early applicants who else they\'d recommend', xp: 15, note: 'The referral field captures it, but ask directly too' },
      { id: 'p1-stoner-reach', name: 'Reach out to Mark Stoner online', xp: 15, note: 'He\'s at NCSG this week \u2014 message after, not during' },
    ]
  },
  {
    id: 'phase2', name: 'Ship the App', timeframe: 'Feb 24\u201328 \u2014 Parallel',
    description: 'Get it in their hands', color: '#3b82f6', icon: '\uD83D\uDE80',
    parallel: 'phase1',
    items: [
      { id: 'p2-bug-fixes', name: 'Final bug fixes complete', xp: 30, note: 'Whatever\'s blocking release' },
      { id: 'p2-prod-apk', name: 'Production APK signed and built', xp: 25, note: 'Release keystore, R8 enabled' },
      { id: 'p2-release-notes', name: 'Release notes v1.0 written', xp: 10, note: 'What\'s in the first release' },
      { id: 'p2-prod-track', name: 'Play Store production track submitted', xp: 35, note: 'Upload signed APK' },
      { id: 'p2-app-approved', name: 'App approved on Play Store', xp: 35, note: 'Google review (24\u201372 hours)' },
      { id: 'p2-update-download', name: 'Update download.html with Play Store link', xp: 15, note: 'Replace notify form with real link' },
      { id: 'p2-announce-live', name: 'Announce "it\'s live" in FB groups + page', xp: 15, note: 'Share the Play Store link everywhere' },
    ]
  },
  {
    id: 'phase3', name: 'Select & Onboard', timeframe: 'Mar 1\u201315',
    description: 'Turn applicants into founding members', color: '#8b5cf6', icon: '\uD83C\uDFAF',
    items: [
      { id: 'p3-review-apps', name: 'Review all applications against selection criteria', xp: 20, note: 'Active inspections, geographic diversity, experience mix' },
      { id: 'p3-select-first5', name: 'Select first 5 founding members', xp: 35, note: 'Best applicants first \u2014 they set the tone' },
      { id: 'p3-send-agreements', name: 'Send founding 25 agreements to first 5', xp: 25, note: 'Solo free for life, 50% off Pro, non-transferable' },
      { id: 'p3-onboarding-guide', name: 'Create onboarding guide ("Your First Inspection")', xp: 25, note: 'Step-by-step from install to finalized report' },
      { id: 'p3-personal-onboard', name: 'Personally onboard first 5 (video call or walkthrough email)', xp: 25, note: 'White-glove \u2014 these are your ambassadors' },
      { id: 'p3-feedback-channel', name: 'Set up direct feedback channel (group text/Signal/Discord)', xp: 20, note: 'Where they talk to you and each other' },
      { id: 'p3-first-feedback', name: 'Collect first round of feedback', xp: 25, note: 'What works, what doesn\'t, what\'s missing' },
      { id: 'p3-ship-fixes', name: 'Ship bug fixes from founding member feedback', xp: 25, note: 'Show them you listen \u2014 fast turnaround matters' },
      { id: 'p3-select-next10', name: 'Select next 10 founding members', xp: 30, note: 'Second wave \u2014 expand geographic coverage' },
      { id: 'p3-email-templates', name: 'Write email templates (welcome, onboarding, follow-up)', xp: 15, note: 'Repeatable communication for remaining waves' },
    ]
  },
  {
    id: 'phase4', name: 'Full Activation', timeframe: 'Mar 15\u201331',
    description: 'They have to love this', color: '#22c55e', icon: '\uD83C\uDFC6',
    items: [
      { id: 'p4-all-25-selected', name: 'All 25 founding members selected and signed', xp: 40, note: 'Curated, not first-come \u2014 final wave complete' },
      { id: 'p4-all-onboarded', name: 'All 25 onboarded with materials', xp: 20, note: 'Guide + app link + direct contact info' },
      { id: 'p4-10-active', name: '10+ founding members actively using app on real jobs', xp: 35, note: 'Not installed \u2014 actually using on inspections' },
      { id: 'p4-first-testimonial', name: 'First founding member testimonial or quote', xp: 25, note: 'Social proof for public launch' },
      { id: 'p4-referral-links', name: 'Create referral share links for founding members', xp: 20, note: 'Easy way for them to spread the word' },
      { id: 'p4-post-milestones', name: 'Post founding member milestones on Facebook', xp: 15, note: '"Our founding sweeps are using SweepNspect on real jobs"' },
      { id: 'p4-analytics', name: 'Google Analytics on website', xp: 15, note: 'Track traffic and conversions' },
      { id: 'p4-second-feedback', name: 'Second feedback round \u2014 polish from real usage', xp: 25, note: 'Iterate based on field experience' },
    ]
  },
  {
    id: 'phase5', name: 'Public Launch', timeframe: 'April',
    description: 'Open the gates', color: '#06b6d4', icon: '\uD83C\uDF10',
    items: [
      { id: 'p5-play-store', name: 'App publicly available on Play Store', xp: 45, note: 'Open production track' },
      { id: 'p5-launch-announcement', name: 'Launch announcement across all channels', xp: 25, note: 'Facebook Page, groups, email list, founding members share' },
      { id: 'p5-fb-outreach', name: 'Facebook chimney community outreach (5+ groups)', xp: 25, note: 'Genuine contribution, not spam \u2014 you\'re already known by now' },
      { id: 'p5-instagram', name: 'Instagram account created + first 10 posts', xp: 15, note: 'Brand presence' },
      { id: 'p5-faq', name: 'FAQ / Knowledge Base published', xp: 20, note: 'Common questions answered' },
      { id: 'p5-payment-live', name: 'Payment processing live (Stripe)', xp: 40, note: 'Trial \u2192 paid conversion path' },
      { id: 'p5-video-tutorial', name: 'First video tutorial: "Your First Inspection"', xp: 25, note: 'Screen recording walkthrough' },
      { id: 'p5-refund-policy', name: 'Refund policy published', xp: 15, note: 'Standard 30-day policy' },
      { id: 'p5-invoice-templates', name: 'Invoice templates finalized', xp: 15, note: 'Professional billing' },
      { id: 'p5-tax-config', name: 'Tax configuration for billing', xp: 15, note: 'Stripe tax settings' },
    ]
  },
  {
    id: 'phase6', name: 'Growth Engine', timeframe: 'Q2 2026+',
    description: 'Keep the ball rolling', color: '#a78bfa', icon: '\uD83D\uDCC8',
    items: [
      { id: 'p6-black-collar', name: 'Black Collar ad campaign launched', xp: 40, note: 'The "60M chimneys, 5000 sweeps" ads \u2014 7 variants ready' },
      { id: 'p6-surefire-referral', name: 'SureFire referral program partnership', xp: 25, note: 'Training \u2192 app pipeline' },
      { id: 'p6-surefire-ceu', name: 'SureFire CEU training content partnership', xp: 30, note: 'Education content collaboration' },
      { id: 'p6-hub-server', name: 'Hub operations server deployed', xp: 25, note: 'Ticket system, subscriber tracking, revenue dashboard' },
      { id: 'p6-ticket-system', name: 'Customer support ticket system live', xp: 25, note: 'Beyond email \u2014 structured support' },
      { id: 'p6-response-templates', name: 'Response templates for common questions', xp: 15, note: 'Efficient support at scale' },
      { id: 'p6-video-tutorials', name: '3+ video tutorials recorded', xp: 20, note: 'Inspection, invoicing, scheduling' },
      { id: 'p6-100-subs', name: '100 active subscribers milestone', xp: 50, note: '$4,900/month MRR' },
      { id: 'p6-support-hire', name: 'Support hire plan documented', xp: 15, note: 'When and who to hire' },
      { id: 'p6-dev-hire', name: 'Developer hire plan documented', xp: 15, note: 'Scaling the team' },
      { id: 'p6-bank-account', name: 'Business bank account set up', xp: 10, note: 'Separate business finances' },
      { id: 'p6-500-subs', name: '500 subscribers milestone', xp: 75, note: '$24,500/month MRR' },
    ]
  },
];

const LEVELS = [
  { threshold: 0, name: 'Getting Started' },
  { threshold: 150, name: 'Founding Pioneer' },
  { threshold: 400, name: 'App Shipper' },
  { threshold: 700, name: 'Community Builder' },
  { threshold: 1100, name: 'Launch Captain' },
  { threshold: 1600, name: 'Growth Engine' },
];

const MILESTONES = [
  { text: 'Founding 25 page live', date: 'Feb 23', status: 'done' },
  { text: 'Facebook Page created', date: 'Feb 24', status: 'active' },
  { text: 'App on Play Store', date: 'Feb 26', status: 'pending' },
  { text: 'First 5 Founding Members confirmed', date: 'Mar 7', status: 'pending' },
  { text: 'All 25 Founding Members active', date: 'Mar 31', status: 'pending' },
  { text: 'Public launch', date: 'April', status: 'pending' },
  { text: '100 subscribers', date: 'Q2', status: 'pending' },
  { text: 'Black Collar campaign live', date: 'Q2', status: 'pending' },
];

// ═══════════════════════════════════════════════════════════
// STATE
// ═══════════════════════════════════════════════════════════

let state = loadState();
let sessionDone = 0;
let sessionXP = 0;

function loadState() {
  try {
    const s = JSON.parse(localStorage.getItem('hub-state'));
    if (s && s.version === 3 && s.items) return s;
  } catch(e) {}
  // Fresh state for v2 — all phase items start unchecked
  const items = {};
  PHASES.forEach(phase => {
    phase.items.forEach(item => {
      items[item.id] = { done: false };
    });
  });
  return { version: 3, items, xp: calcXPFromItems(items) };
}

function saveState() {
  localStorage.setItem('hub-state', JSON.stringify(state));
}

function calcXPFromItems(items) {
  let xp = FOUNDATION_XP;
  PHASES.forEach(phase => {
    phase.items.forEach(item => {
      if (items[item.id] && items[item.id].done) xp += item.xp;
    });
  });
  return xp;
}

function calcXP() {
  return calcXPFromItems(state.items);
}

function getLevel(xp) {
  let lvl = 0;
  for (let i = LEVELS.length - 1; i >= 0; i--) {
    if (xp >= LEVELS[i].threshold) { lvl = i; break; }
  }
  return lvl;
}

function getPhaseStats(phase) {
  let done = 0, total = phase.items.length;
  phase.items.forEach(item => {
    if (state.items[item.id] && state.items[item.id].done) done++;
  });
  return { done, total, pct: total > 0 ? Math.round((done / total) * 100) : 0 };
}

function getAllStats() {
  let done = 0, total = 0;
  PHASES.forEach(phase => {
    const s = getPhaseStats(phase);
    done += s.done;
    total += s.total;
  });
  return { done, total, pct: Math.round((done / total) * 100) };
}

function pctClass(pct) {
  if (pct >= 75) return 'high';
  if (pct >= 25) return 'mid';
  if (pct === 0) return 'zero';
  return 'low';
}

// ═══════════════════════════════════════════════════════════
// PHASE DETECTION
// ═══════════════════════════════════════════════════════════

function getCurrentPhaseIndices() {
  const now = new Date();
  const y = now.getFullYear();
  const m = now.getMonth() + 1;
  const d = now.getDate();

  // Phase 0: Launch Prep (today — Feb 24, or until complete)
  if (y === 2026 && m === 2 && d <= 24) {
    const p0 = getPhaseStats(PHASES[0]);
    if (p0.done < p0.total) return [0, 1, 2];
    return [1, 2];
  }
  // Phase 1 + 2: Founding Drive + Ship App (Feb 24 — Mar 7)
  if (y === 2026 && m === 2 && d >= 24) return [1, 2];
  if (y === 2026 && m === 3 && d <= 7) return [1, 2];
  // Phase 3: Select & Onboard (Mar 8-15)
  if (y === 2026 && m === 3 && d >= 8 && d <= 15) return [3];
  // Phase 4: Full Activation (Mar 16-31)
  if (y === 2026 && m === 3 && d >= 16) return [4];
  // Phase 5: Public Launch (April)
  if (y === 2026 && m === 4) return [5];
  // Phase 6: Growth Engine (May+)
  if (y >= 2026 && (m >= 5 || y > 2026)) return [6];

  // Fallback — show Phase 0
  return [0];
}

function isCurrentPhase(phaseIdx) {
  return getCurrentPhaseIndices().includes(phaseIdx);
}

function isPrimaryCurrentPhase(phaseIdx) {
  const current = getCurrentPhaseIndices();
  return current.length > 0 && current[0] === phaseIdx;
}

// ═══════════════════════════════════════════════════════════
// RENDER
// ═══════════════════════════════════════════════════════════

function renderStats() {
  const all = getAllStats();
  const totalWithFoundation = all.done + FOUNDATION_COUNT;
  const totalAll = all.total + FOUNDATION_COUNT;
  const overallPct = Math.round((totalWithFoundation / totalAll) * 100);
  const phasesDone = PHASES.filter(p => getPhaseStats(p).pct === 100).length;
  const currentNames = getCurrentPhaseIndices().map(i => PHASES[i].name);

  document.getElementById('statsRow').innerHTML = `
    <div class="stat-card">
      <div class="stat-label">Tasks Complete</div>
      <div class="stat-value accent">${totalWithFoundation}<span style="font-size:14px;color:var(--text-dim);">/${totalAll}</span></div>
      <div class="stat-sub">${overallPct}% overall</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Current Phase</div>
      <div class="stat-value" style="color:${PHASES[getCurrentPhaseIndices()[0]].color};font-size:16px;">${currentNames[0]}</div>
      <div class="stat-sub">${phasesDone} of ${PHASES.length} phases clear</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Total XP</div>
      <div class="stat-value accent">${state.xp}</div>
      <div class="stat-sub">Level ${getLevel(state.xp) + 1}</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Foundation</div>
      <div class="stat-value green">${FOUNDATION_COUNT}</div>
      <div class="stat-sub">${FOUNDATION_XP} XP banked</div>
    </div>
  `;
}

function renderFoundation() {
  const container = document.getElementById('foundationContainer');
  container.innerHTML = `
    <div class="foundation-section" id="foundationSection">
      <div class="foundation-header" id="foundationHeader">
        <div class="foundation-icon">\u2705</div>
        <div class="foundation-title">Foundation Complete</div>
        <div class="foundation-stats">${FOUNDATION_COUNT} items \u00B7 ${FOUNDATION_XP} XP</div>
        <div class="foundation-chevron">\u25BE</div>
      </div>
      <div class="foundation-body">
        <div class="foundation-body-inner">
          ${FOUNDATION.map(g => `
            <div class="foundation-group">
              <div class="foundation-group-name">${g.group}</div>
              ${g.items.map(item => `
                <div class="foundation-item">
                  <div class="foundation-check"></div>
                  <span>${item}</span>
                </div>
              `).join('')}
            </div>
          `).join('')}
        </div>
      </div>
    </div>
  `;
  document.getElementById('foundationHeader').addEventListener('click', () => {
    document.getElementById('foundationSection').classList.toggle('expanded');
  });
}

function renderPhases() {
  const container = document.getElementById('phasesContainer');
  container.innerHTML = '';
  const currentIndices = getCurrentPhaseIndices();

  PHASES.forEach((phase, idx) => {
    const stats = getPhaseStats(phase);
    const cls = pctClass(stats.pct);
    const isCurrent = currentIndices.includes(idx);
    const isPrimary = currentIndices[0] === idx;

    const card = document.createElement('div');
    card.className = 'phase-card' + (isCurrent ? ' current' : '');
    card.dataset.phaseId = phase.id;

    // Auto-expand current phase
    if (isPrimary) card.classList.add('expanded');

    const colorBg = phase.color + '18';
    const liveBadge = isCurrent
      ? `<span class="phase-badge-live" style="color:${phase.color};background:${phase.color}20;border:1px solid ${phase.color}40;">${isPrimary ? 'LIVE' : 'ACTIVE'}</span>`
      : '';
    const parallelBadge = phase.parallel
      ? `<span class="phase-badge-parallel">\u21C4 Parallel with ${PHASES.find(p => p.id === phase.parallel)?.name || ''}</span>`
      : '';

    card.innerHTML = `
      <div class="phase-dot${isCurrent ? ' current' : ''}" style="background:${phase.color};color:${phase.color};"></div>
      <div class="phase-color-bar" style="background:${phase.color};"></div>
      <div class="phase-header">
        <div class="phase-number" style="background:${colorBg};color:${phase.color};">${idx}</div>
        <div class="phase-info">
          <div class="phase-name-row">
            <span class="phase-name">${phase.name}</span>
            ${liveBadge}
            ${parallelBadge}
          </div>
          <div class="phase-meta">
            <span class="phase-timeframe">${phase.timeframe}</span>
            <span class="phase-desc">${phase.description}</span>
          </div>
        </div>
        <div class="phase-progress">
          <span class="phase-pct ${cls}">${stats.pct}%</span>
        </div>
      </div>
      <div class="phase-bar"><div class="phase-bar-fill" style="width:${stats.pct}%;background:${phase.color};box-shadow:0 0 8px ${phase.color}40;"></div></div>
      <div class="phase-items">
        <div class="phase-items-inner">
          ${phase.items.map(item => {
            const done = state.items[item.id] && state.items[item.id].done;
            return `<div class="check-item ${done ? 'done' : ''}" data-item-id="${item.id}">
              <div class="check-box ${done ? 'checked' : ''}" data-item-id="${item.id}"></div>
              <div class="check-content">
                <div class="check-label">${item.name}</div>
                ${item.note ? `<div class="check-note">${item.note}</div>` : ''}
              </div>
              <span class="check-xp">+${item.xp} XP</span>
            </div>`;
          }).join('')}
        </div>
      </div>
    `;

    card.querySelector('.phase-header').addEventListener('click', () => {
      card.classList.toggle('expanded');
    });

    card.querySelectorAll('.check-box').forEach(cb => {
      cb.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleItem(cb.dataset.itemId, cb);
      });
    });

    container.appendChild(card);
  });
}

function renderUpNext() {
  const currentIndices = getCurrentPhaseIndices();
  let upNextItems = [];

  // Gather from current phases first
  for (const phaseIdx of currentIndices) {
    const phase = PHASES[phaseIdx];
    phase.items.forEach(item => {
      if (!(state.items[item.id] && state.items[item.id].done)) {
        upNextItems.push({ ...item, phaseName: phase.name, phaseColor: phase.color, phaseId: phase.id });
      }
    });
  }

  // If current phases all done, look ahead
  if (upNextItems.length === 0) {
    const maxCurrent = Math.max(...currentIndices);
    for (let i = maxCurrent + 1; i < PHASES.length; i++) {
      const phase = PHASES[i];
      phase.items.forEach(item => {
        if (!(state.items[item.id] && state.items[item.id].done)) {
          upNextItems.push({ ...item, phaseName: phase.name, phaseColor: phase.color, phaseId: phase.id });
        }
      });
      if (upNextItems.length > 0) break;
    }
  }

  const top5 = upNextItems.slice(0, 5);
  document.getElementById('upNext').innerHTML = top5.length > 0
    ? top5.map(item => `
      <div class="up-next-item" data-item-id="${item.id}">
        <div class="up-next-tag" style="color:${item.phaseColor};background:${item.phaseColor}15;border:1px solid ${item.phaseColor}30;">${item.phaseName}</div>
        <div class="up-next-name">${item.name}</div>
        <button class="up-next-btn" onclick="focusItem('${item.id}')">Focus</button>
      </div>
    `).join('')
    : '<div style="font-size:12px;color:var(--text-dim);text-align:center;padding:20px 0;">All done! You\'re a Growth Engine.</div>';
}

function renderMilestones() {
  document.getElementById('milestones').innerHTML = MILESTONES.map(m => `
    <div class="milestone-item">
      <div class="milestone-dot ${m.status}"></div>
      <div class="milestone-text ${m.status === 'done' ? 'done' : ''}">${m.text}</div>
      <div class="milestone-date">${m.date}</div>
    </div>
  `).join('');
}

function renderTopBar() {
  const all = getAllStats();
  const totalWithFoundation = all.done + FOUNDATION_COUNT;
  const totalAll = all.total + FOUNDATION_COUNT;
  const overallPct = Math.round((totalWithFoundation / totalAll) * 100);

  const circumference = 2 * Math.PI * 18;
  const offset = circumference - (overallPct / 100) * circumference;
  document.getElementById('readinessCircle').style.strokeDashoffset = offset;
  document.getElementById('readinessPct').textContent = overallPct + '%';

  const lvl = getLevel(state.xp);
  const nextLvl = lvl < LEVELS.length - 1 ? LEVELS[lvl + 1].threshold : LEVELS[lvl].threshold;
  const currThreshold = LEVELS[lvl].threshold;
  const progress = nextLvl > currThreshold ? ((state.xp - currThreshold) / (nextLvl - currThreshold)) * 100 : 100;

  document.getElementById('levelBadge').textContent = 'LVL ' + (lvl + 1);
  document.getElementById('levelName').textContent = LEVELS[lvl].name;
  document.getElementById('xpBarFill').style.width = progress + '%';
  document.getElementById('xpText').textContent = state.xp + ' / ' + nextLvl + ' XP';

  // Today's date
  const now = new Date();
  document.getElementById('todayDate').textContent =
    now.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
}

function renderSession() {
  document.getElementById('sessionDone').textContent = sessionDone;
  document.getElementById('sessionXP').textContent = sessionXP;
}

// ═══════════════════════════════════════════════════════════
// INTERACTIONS
// ═══════════════════════════════════════════════════════════

function toggleItem(itemId, checkboxEl) {
  const wasDone = state.items[itemId] && state.items[itemId].done;
  state.items[itemId] = { done: !wasDone };
  state.xp = calcXP();

  if (!wasDone) {
    let xpVal = 0;
    PHASES.forEach(phase => phase.items.forEach(item => {
      if (item.id === itemId) xpVal = item.xp;
    }));
    sessionDone++;
    sessionXP += xpVal;
    showXPPopup(checkboxEl, xpVal);

    const oldLvl = getLevel(state.xp - xpVal);
    const newLvl = getLevel(state.xp);
    if (newLvl > oldLvl) showLevelUp();
  } else {
    let xpVal = 0;
    PHASES.forEach(phase => phase.items.forEach(item => {
      if (item.id === itemId) xpVal = item.xp;
    }));
    sessionDone = Math.max(0, sessionDone - 1);
    sessionXP = Math.max(0, sessionXP - xpVal);
  }

  saveState();
  renderAll();
}

function showXPPopup(el, xp) {
  const rect = el.getBoundingClientRect();
  const popup = document.createElement('div');
  popup.className = 'xp-popup';
  popup.textContent = '+' + xp + ' XP';
  popup.style.left = (rect.left + rect.width / 2) + 'px';
  popup.style.top = (rect.top) + 'px';
  document.body.appendChild(popup);
  requestAnimationFrame(() => {
    popup.classList.add('show');
    setTimeout(() => {
      popup.classList.add('fade');
      setTimeout(() => popup.remove(), 400);
    }, 600);
  });
}

function showLevelUp() {
  const overlay = document.getElementById('levelUpOverlay');
  overlay.classList.add('show');
  setTimeout(() => overlay.classList.remove('show'), 800);
}

function focusItem(itemId) {
  PHASES.forEach(phase => {
    phase.items.forEach(item => {
      if (item.id === itemId) {
        const card = document.querySelector(`.phase-card[data-phase-id="${phase.id}"]`);
        if (card) {
          card.classList.add('expanded');
          const checkItem = card.querySelector(`.check-item[data-item-id="${itemId}"]`);
          if (checkItem) {
            setTimeout(() => {
              checkItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
              checkItem.style.background = 'var(--accent-dim)';
              setTimeout(() => checkItem.style.background = '', 1500);
            }, 350);
          }
        }
      }
    });
  });
}

function renderAll() {
  renderStats();
  renderFoundation();
  renderPhases();
  renderUpNext();
  renderMilestones();
  renderTopBar();
  renderSession();
}

// ═══════════════════════════════════════════════════════════
// CLOCK & INIT
// ═══════════════════════════════════════════════════════════

function updateClock() {
  const now = new Date();
  document.getElementById('clock').textContent =
    now.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' ' +
    now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
}

// Notifications
document.getElementById('notifBtn').addEventListener('click', (e) => {
  e.stopPropagation();
  document.getElementById('notifDropdown').classList.toggle('open');
});

document.addEventListener('click', () => {
  document.getElementById('notifDropdown').classList.remove('open');
});

// Init
renderAll();
updateClock();
setInterval(updateClock, 30000);

// Streak tracking
const today = new Date().toDateString();
const lastVisit = localStorage.getItem('hub-last-visit');
let streak = parseInt(localStorage.getItem('hub-streak') || '0');
if (lastVisit !== today) {
  const yesterday = new Date(Date.now() - 86400000).toDateString();
  streak = lastVisit === yesterday ? streak + 1 : 1;
  localStorage.setItem('hub-streak', streak);
  localStorage.setItem('hub-last-visit', today);
}
document.getElementById('streak').textContent = streak + ' day' + (streak !== 1 ? 's' : '');
</script>
</body>
</html>
